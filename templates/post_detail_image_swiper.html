<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>{{POST_TITLE}}</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/5.4.4/photoswipe.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color: #0a0a0a; color: #e4e4e4; line-height: 1.6; }
        .container { max-width: 600px; margin: 0 auto; background-color: #000; min-height: 100vh; }
        .header { padding: 12px 16px; border-bottom: 1px solid #262626; display: flex; align-items: center; justify-content: space-between; }
        .header h1 { font-size: 16px; font-weight: 600; }
        .image-grid { width: 100%; aspect-ratio: 1; background-color: #000; position: relative; }
        .swiper { width: 100%; height: 100%; }
        .swiper-wrapper { height: 100%; }
        .swiper-slide { display: flex; align-items: center; justify-content: center; height: 100%; }
        .image-item { position: relative; overflow: hidden; cursor: pointer; background-color: #1a1a1a; width: 100%; height: 100%; display: block; }
        .image-item img { width: 100%; height: 100%; object-fit: cover; display: block; transition: transform 0.3s ease; }
        .image-item:hover img { transform: scale(1.03); }
        .swiper-pagination-bullet { background: rgba(255,255,255,0.65); opacity: 0.5; }
        .swiper-pagination-bullet-active { background: #3b82f6; }
        .swiper-button-next, .swiper-button-prev { position: absolute; top: 50%; transform: translateY(-50%); width: 40px; height: 40px; border-radius: 999px; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.45); border: 1px solid rgba(255,255,255,0.08); color: #ffffff; z-index: 20; cursor: pointer; opacity: 0.5; }
        .swiper-button-next { right: 8px; } .swiper-button-prev { left: 8px; }
        .swiper-button-next svg, .swiper-button-prev svg { width: 18px; height: 18px; stroke: currentColor; fill: none; stroke-width: 2; }
        .actions { padding: 12px 16px; display: flex; gap: 16px; border-bottom: 1px solid #262626; }
        .action-btn { background: none; border: none; cursor: pointer; padding: 0; display: flex; align-items: center; gap: 6px; color: #e4e4e4; font-size: 14px; transition: opacity 0.2s; }
        .action-btn:hover { opacity: 0.7; }
        .action-btn svg { width: 24px; height: 24px; stroke: currentColor; fill: none; stroke-width: 2; }
        .content { padding: 16px; }
        .content p { margin-bottom: 12px; white-space: pre-line; }
        .content strong { color: #fff; display: block; margin-bottom: 0px; font-size: 15px; }
        .content ul { list-style: none; margin: 12px 0; }
        .content ul li { margin-bottom: 8px; padding-left: 0; }
        .links { margin-top: 16px; padding-top: 16px; border-top: 1px solid #262626; }
        .showcs { margin-top: 16px; padding-top: 16px; border-top: 0; }
        .links a, .showcs a { color: #3b82f6; text-decoration: none; }
        .links a:hover, .showcs a:hover { text-decoration: underline; }
        .hashtags { margin-top: 16px; color: #3b82f6; font-size: 14px; line-height: 1.5; }
        @media (max-width: 600px) { .container { max-width: 100%; } .swiper-button-next, .swiper-button-prev { width: 36px; height: 36px; } }
        .pswp__img { object-fit: contain; }
        .back-row { display: flex; align-items: center; gap: 10px; }
        .back-link { display: inline-flex; align-items: center; justify-content: center; width: 40px; height: 40px; min-width: 40px; border-radius: 8px; background: transparent; border: 1px solid rgba(255,255,255,0.04); color: #e6eef8; text-decoration: none; transition: background .15s ease, transform .12s ease, box-shadow .12s ease; }
        .back-link:hover { background: rgba(255,255,255,0.03); transform: translateY(-1px); box-shadow: 0 6px 18px rgba(0,0,0,0.55); }
        .back-link:focus { outline: 3px solid rgba(59,130,246,0.25); outline-offset: 2px; }
        .back-icon { width: 18px; height: 18px; display: block; stroke: currentColor; fill: none; stroke-width: 1.5; }
        .post-title { font-size: 16px; color: #fff; font-weight: 600; line-height: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        @media (max-width:420px){ .back-link { width:44px; height:44px; } .back-icon { width:20px; height:20px; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="back-row">
            <a class="back-link" href="{{BACK_TO_GRID_URL}}" id="backToGrid" title="Back to gallery" aria-label="Back to gallery">
                <svg class="back-icon" viewBox="0 0 24 24" aria-hidden="true"><rect x="3" y="3" width="7" height="7" rx="1.2"/><rect x="14" y="3" width="7" height="7" rx="1.2"/><rect x="3" y="14" width="7" height="7" rx="1.2"/><rect x="14" y="14" width="7" height="7" rx="1.2"/></svg>
            </a>
            <div class="header">
                <h1 class="post-title">{{POST_TITLE}}</h1>
            </div>
        </div>

        <div class="image-grid" id="gallery">
            <div class="swiper" id="gallery-swiper">
                <div class="swiper-wrapper"></div>
                <div class="swiper-pagination"></div>
                <button class="swiper-button-prev" aria-label="Previous"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M15 18l-6-6 6-6"/></svg></button>
                <button class="swiper-button-next" aria-label="Next"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M9 6l6 6-6 6"/></svg></button>
            </div>
        </div>

        <div class="actions">
            <button class="action-btn" id="shareBtn">
                <svg viewBox="0 0 24 24"><path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/></svg>
                <span>Share</span>
            </button>
        </div>
        
        <div class="content">
            {{POST_CONTENT}}
        </div>
    </div>

    <script type="module">
        import PhotoSwipeLightbox from 'https://cdnjs.cloudflare.com/ajax/libs/photoswipe/5.4.4/photoswipe-lightbox.esm.min.js';
        import PhotoSwipe from 'https://cdnjs.cloudflare.com/ajax/libs/photoswipe/5.4.4/photoswipe.esm.min.js';
        import Swiper from 'https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.esm.browser.min.js';

        const images = {{MEDIA_ITEMS_JSON}};

        const wrapper = document.querySelector('#gallery-swiper .swiper-wrapper');
        if (wrapper) {
            wrapper.innerHTML = images.map((img, i) => `
                <div class="swiper-slide">
                    <div class="image-item" data-index="${i}">
                        <img loading="lazy" decoding="async" width="${img.width || 1024}" height="${img.height || 1024}" src="${img.src}" alt="${img.alt}">
                    </div>
                </div>
            `).join('');
        }

        const lightbox = new PhotoSwipeLightbox({
            dataSource: images,
            pswpModule: PhotoSwipe,
            bgOpacity: 0.95,
            spacing: 0.1
        });
        lightbox.init();

        const swiper = new Swiper('#gallery-swiper', {
            slidesPerView: 1, spaceBetween: 2, loop: false,
            navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' },
            pagination: { el: '.swiper-pagination', clickable: true },
            keyboard: { enabled: true },
            grabCursor: true
        });

        document.querySelectorAll('#gallery-swiper .image-item').forEach((item) => {
            item.addEventListener('click', () => {
                const idx = parseInt(item.getAttribute('data-index'), 10) || 0;
                lightbox.loadAndOpen(idx);
            });
        });

        document.getElementById('shareBtn').addEventListener('click', async () => {
            const shareData = {
                title: '{{POST_TITLE}}',
                text: document.querySelector('.content p')?.textContent || 'Check this out!',
                url: window.location.href
            };
            try {
                if (navigator.share) { await navigator.share(shareData); } 
                else { await navigator.clipboard.writeText(shareData.url); alert('Link copied to clipboard!'); }
            } catch (err) { console.log('Share failed:', err); }
        });
    </script>
</body>
</html>

